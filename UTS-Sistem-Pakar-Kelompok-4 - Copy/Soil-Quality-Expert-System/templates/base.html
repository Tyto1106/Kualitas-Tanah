<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form Diagnosis Kualitas Tanah</title>

    <!-- Add Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* Body and Background */
        body {
            margin: 0;
            background-image: url('{{ url_for("static", filename="pict1.jpg") }}');
            background-size: cover;
            background-position: center;
            backdrop-filter: blur(8px);
            font-family: 'Roboto', sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            align-items: center;
        }

        header {
            width: 100%;
            color: white;
            text-align: center;
            font-size: 18px;
            padding: 15px 0 30px 0;
            top: 0;
            z-index: 10;
            border-bottom-right-radius: 5px;
            border-bottom-left-radius: 5px;
            background: rgba(0, 0, 0, 0.5); /* Semi-transparent background for readability */
        }

        main {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            flex: 1;
        }

        .diag-container {
            width: 90%;
            max-width: 600px;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            background-color: rgba(248, 248, 255, 0.95);
            margin-top: 20px;
            margin-bottom: 30px;
            overflow: hidden;
            position: relative;
        }

        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .Keterangan {
            margin-bottom: 20px;
            border-bottom: 5px solid #997950;
            padding-bottom: 10px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            font-family: 'Roboto', sans-serif;
            color: #fff;
            background-color: rgb(193, 154, 107);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background-color: rgb(167, 95, 67);
        }

        .result-container {
            margin-top: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.95);
        }

        .result-container h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .percentage {
            font-size: 20px;
            font-weight: bold;
            color: #007bff;
            margin: 10px 0;
        }

        .button-container {
            text-align: center;
            margin-top: 20px;
        }

        .button-container button {
            width: auto;
            padding: 10px 20px;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .nav-buttons button {
            width: 48%;
            padding: 10px;
            font-size: 16px;
            font-family: 'Roboto', sans-serif;
            color: #fff;
            background-color: rgb(193, 154, 107);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .nav-buttons button:hover {
            background-color: rgb(167, 95, 67);
        }

        .hidden {
            display: none;
        }

        /* Educational Content Styling */
        .education-section {
            margin-bottom: 20px;
        }

        .education-section img {
            width: 100%;
            max-width: 400px;
            height: auto;
            display: block;
            margin: 10px auto;
        }
    </style>
</head>

<body>
    <header>
        <h1>Form Diagnosis Kualitas Tanah</h1>
    </header>

    <main>
        <div class="diag-container">
            <h2 id="formTitle">Form Diagnosis Kualitas Tanah</h2>
            <div class="Keterangan" id="formDescription">
                <p>Isilah form ini sesuai dengan gejala yang ada pada tanah atau lahan perkebunan anda.</p>
            </div>

            <!-- Multi-Step Form -->
            <form id="diagnosisForm" action="{{ url_for('diagnose') }}" method="POST">
                <!-- Step 1: Kestabilan Agregat Tanah -->
                <div class="step" id="step-1">
                    <div class="education-section">
                        <h3>Tingkat Kestabilan Agregat Tanah</h3>
                        <p>
                            Kestabilan agregat tanah merujuk pada kemampuan tanah untuk mempertahankan struktur agregatnya terhadap berbagai gaya yang dapat merusaknya seperti erosi akibat angin, tetesan hujan, aliran air irigasi, dan tekanan dari aktivitas pengolahan tanah.
                        </p>
                        <img src="{{ url_for('static', filename='porositas.jpg') }}" alt="Kestabilan Agregat Tanah">
                        <y>Alat dan Bahan:<br>
                            1. Tabung jar dengan tinggi 16,5 cm dan diameter 8 cm.<br>
                            2. Keranjang terbuat dari kawat ram dengan ukuran lubang 0,5 x 0,5 cm.<br>
                            3. Stop watch.<br>
                            4. Contoh ped tanah.<br>
                            5. Air.<br><br>
                            Cara Kerja:<br>
                            1. Masukkan air ke dalam jar hingga penuh.<br>
                            2. Letakkan keranjang kawat ram di mulut jar.<br>
                            3. Letakkan contoh ped tanah di dalam keranjang kawat ram.<br>
                            4. Ukur waktu (detik) mulai hancurnya contoh ped tanah dalam keranjang kawat ram yang ditandai oleh lepasnya butiran tanah dari contoh ped.<br>
                            5. Semakin lama contoh ped tanah hancur maka kestabilan agregat tanah semakin tinggi. Amati hingga kurang lebih selama 120 detik. <br><br>
                            </y>
                    </div>
                    <label for="KestabilanAgregat">Tingkat Kestabilan Agregat Tanah (Detik):</label>
                    <input type="number" id="KestabilanAgregat" name="KestabilanAgregat" min="1" max="10" required>
                </div>

                <!-- Step 2: Kemampuan Menyerap Air -->
                <div class="step hidden" id="step-2">
                    <div class="education-section">
                        <h3>Kemampuan Tanah dalam Menyerap Air</h3>
                        <p>
                            Infiltrasi adalah proses masuknya air ke dalam tanah yang biasanya terjadi melalui permukaan tanah secara vertikal. Kemampuan ini penting untuk menghindari erosi dan menjaga kelembaban tanah.
                        </p>
                        <img src="{{ url_for('static', filename='inf.jpeg') }}" alt="Kemampuan Menyerap Air">
                        <y>Alat dan Bahan:<br>
                            1. Ring sampel terbuat dari pipa paralon diameter 3,2 inch (8cm) dengan tinggi 1,6 inch (4 cm) dengan salah satu sisi
                            dibuat lancip.<br>
                            2. Palu.<br>
                            3. Alas papan.<br>
                            4. Plastik jernih 1 lembar.<br>
                            5. Botol plastik 500 ml.<br>
                            6. Air.<br>
                            7. Stop watch.<br><br>
                            Cara Kerja:<br>
                            1. Masukkan pipa paralon (sisi lancip di bagian bawah) ke dalam tanah dengan kedalaman 2 cm menggunakan palu dan alas papan, sisakan ketinggian pipa paralon 2 cm dari permukaan tanah.<br>
                            2. Tutup permukaan tanah di bagian dalam pipa paralon dengan selembar plastik untuk mencegah gangguan pada permukaan tanah saat menambahkan air.<br>
                            3. Tuangkan air 100 ml ke atas lembaran plastik dalam pipa paralon dan lepaskan lembaran plastik dengan menariknya perlahan keluar.<br><br>
                            </y>
                    </div>
                    <label for="Infiltrasi">Kemampuan Tanah dalam Menyerap Air (detik):</label>
                    <input type="number" id="Infiltrasi" name="Infiltrasi" min="1" max="10" required>
                </div>

                <!-- Step 3: Tingkat Kedalaman Efektif -->
                <div class="step hidden" id="step-3">
                    <div class="education-section">
                        <h3>Tingkat Kedalaman Efektif</h3>
                        <p>
                            Kedalaman efektif tanah mempengaruhi kemampuan akar tanaman untuk menyerap nutrisi dan air. Tanah dengan kedalaman efektif yang baik mendukung pertumbuhan tanaman yang sehat.
                        </p>
                        <img src="{{ url_for('static', filename='akar.png') }}" alt="Kedalaman Efektif">
                        <y>Alat dan Bahan:<br>
                            1. Cangkul atau sekop.<br>
                            2. Pisau.<br>
                            3. Meteran.<br>
                            4. Singkapan tanah atau profil tanah.<br><br>
                            Cara Kerja:<br>
                            1. Tentukan singkapan tanah atau gali profil tanah yang diatasnya terdapat vegetasi tanaman.<br>
                            2. Segarkan sisi permukaan singkapan atau profil tanah dengan menggunakan pisau.<br><br>
                            </y>
                    </div>
                    <label for="KedalamanEfektif">Tingkat Kedalaman Efektif (cm):</label>
                    <input type="number" id="KedalamanEfektif" name="KedalamanEfektif" min="10" max="200" required>
                </div>

                <!-- Step 4: Tingkat Keasaman (pH) Tanah -->
                <div class="step hidden" id="step-4">
                    <div class="education-section">
                        <h3>Tingkat Keasaman (pH) Tanah</h3>
                        <p>
                            pH tanah menggambarkan tingkat keasaman atau kebasaan tanah, yang berkaitan dengan konsentrasi ion hidrogen (H+) di dalamnya. Nilai pH yang optimal diperlukan untuk penyerapan nutrisi oleh tanaman.
                        </p>
                        <img src="{{ url_for('static', filename='ph.jpg') }}" alt="pH Tanah">
                        <y>Alat dan Bahan:<br>
                            1. pH meter saku.<br>
                            2. Air.<br><br>
                            Cara Kerja:<br>
                            1. Siram permukaan tanah dengan air jika tanah dalam kondisi kering atau tanah lembab dalam ring sampel untuk menentukan infiltrasi tanah dapat digunakan untuk menetapkan pH tanah.<br>
                            2. Genggam pegangan pH meter dan tekankan elektroda logam secara vertikal pada permukaan tanah sampai penembusan mencapai batas kalibrasi.<br>
                            3. Baca pH tanah pada skala pH meter.<br>
                            4. Bersihkan elektroda logam pH meter.<br>
                            </y>
                    </div>
                    <label for="pHTanah">Tingkat Keasaman (pH) Tanah :</label>
                    <input type="number" step="0.1" id="pHTanah" name="pHTanah" min="3" max="9" required>
                </div>

                <!-- Step 5: Jumlah Perakaran pada Lahan -->
                <div class="step hidden" id="step-5">
                    <div class="education-section">
                        <h3>Jumlah Perakaran pada Lahan</h3>
                        <p>
                            Jumlah perakaran dapat diukur dengan menghitung jumlah akar pada area penampang tanah tertentu atau persentase luas perakaran pada area yang sama. Akar yang sehat meningkatkan penyerapan air dan nutrisi serta stabilitas tanah.
                        </p>
                        <img src="{{ url_for('static', filename='akar.png') }}" alt="Jumlah Perakaran">
                        <y>Alat dan Bahan:<br>
                            1. Cangkul atau sekop.<br>
                            2. Pisau.<br>
                            3. Kuadran terbuat dari tali rapia dengan ukuran 30 x 30 cm.<br>
                            4. Bidang penampang tanah berukuran 30 x 30 cm yang berasal dari singkapan tanah atau profil tanah.<br><br>
                            Cara Kerja:<br>
                            1. Tentukan singkapan tanah atau gali profil tanah yang di atasnya terdapat vegetasi tanaman.<br>
                            2. Segarkan sisi permukaan singkapan atau profil tanah dengan menggunakan pisau.<br>
                            3. Amati dan hitung jumlah akar (buah) yang dapat dilihat oleh mata telanjang yang diketemukan pada bidang penampang tanah berukuran 30 x 30 cm.<br><br>
                            </y>
                    </div>
                    <label for="BanyaknyaPerakaran">Jumlah Perakaran pada Lahan :</label>
                    <input type="number" id="BanyaknyaPerakaran" name="BanyaknyaPerakaran" min="0" max="100" required>
                </div>

                <!-- Step 6: Populasi Cacing dalam Tanah -->
                <div class="step hidden" id="step-6">
                    <div class="education-section">
                        <h3>Populasi Cacing dalam Tanah</h3>
                        <p>
                            Cacing tanah berperan penting dalam meningkatkan kesuburan tanah dengan cara mendistribusikan bahan organik, menyebarkan mikroba, serta menciptakan lubang-lubang yang dapat meningkatkan infiltrasi dan aerasi tanah.
                        </p>
                        <img src="{{ url_for('static', filename='cacing.jpeg') }}" alt="Populasi Cacing">
                        <y>Alat dan Bahan:<br>
                            1. Kuadran yang terbuat dari lempengan besi berukuran p x l x t = 15 x 15 x 10 cm (2250 cm3).<br>
                            2. Palu.<br>
                            3. Alas papan.<br>
                            4. Alat pencungkil seperti linggis.<br>
                            5. Pisau.<br>
                            6. Toples besar atau wadah untuk koleksi cacing.<br>
                            7. Air (2 l).<br>
                            8. Larutan deterjen 15 ml/l air (±1 sendok makan).<br><br>
                            Cara Kerja:<br>
                            1. Pilih lokasi tanah yang mewakili (representatif), hindarkan tempat-tempat yang mungkin mempengaruhi populasi cacing tanah, seperti mulsa atau tumpukan kompos.<br>
                            2. Masukkan kuadran seluruhnya ke dalam tanah dengan cara memukulnya dengan menggunakan palu dan alas papan.<br>
                            3. Gali dan ambil kuadran dengan menggunakan alat pencungkil seperti linggis.<br>
                            4. Ratakan bagian sisi bawah kuadran dengan menggunakan pisau dan hindari seminimal mungkin kerusakan pada cacing tanah karena terpotong oleh pisau.<br>
                            5. Ambil massa tanah dalam kuadran dan tempatkan di atas plastik lalu ambil cacing tanah dan tempatkan dalam toples koleksi (metode hand sorting).<br>
                            6. Siramkan larutan deterjen sebanyak 2 l ke dalam lubang galian (dasar lubang galian harus rata) untuk memunculkan cacing tanah yang membuat lubang dalam. Biasanya dalam waktu 5 menit akan keluar cacing tanah. Ambil cacing tanah tersebut dan masukkan ke dalam toples koleksi.<br>
                            </y>
                    </div>
                    <label for="PopulasiCacing">Jumlah Populasi Cacing dalam Tanah (ekor):</label>
                    <input type="number" id="PopulasiCacing" name="PopulasiCacing" min="0" max="1000" required>
                </div>

                <!-- Navigation Buttons -->
                <div class="nav-buttons">
                    <button type="button" id="prevBtn" onclick="prevStep()" class="hidden">Sebelumnya</button>
                    <button type="button" id="nextBtn" onclick="nextStep()">Selanjutnya</button>
                </div>
            </form>

            <!-- Hasil Diagnosa -->
            {% if diagnosis_results %}
            <div class="result-container">
                <h3>Hasil Diagnosa</h3>
                <p>Diagnosis Result: {{ diagnosis_results[0] }}</p>
                <div class="percentage">{{ (diagnosis_results[1] * 100) | round(2) }}%</div>
                <p>Indeks Kesehatan Tanah (IKT): {{ ikt }}</p>
                <p>Kategori: {{ kategori }}</p>
                <div class="button-container">
                    <button onclick="window.location.href='{{ url_for('start') }}'">Kembali ke Halaman Utama</button>
                </div>
            </div>
            {% endif %}
        </div>
    </main>

    <script>
        let currentStep = 1;
        const totalSteps = 6; // Update this if you add more steps

        const steps = document.querySelectorAll('.step');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const diagnosisForm = document.getElementById('diagnosisForm');

        function showStep(step) {
            steps.forEach((div, index) => {
                div.classList.add('hidden');
                if (index + 1 === step) {
                    div.classList.remove('hidden');
                }
            });

            // Update button visibility
            if (step === 1) {
                prevBtn.classList.add('hidden');
            } else {
                prevBtn.classList.remove('hidden');
            }

            if (step === totalSteps) {
                nextBtn.textContent = 'Diagnosa';
            } else {
                nextBtn.textContent = 'Selanjutnya';
            }
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
            } else {
                // Submit the form
                diagnosisForm.submit();
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        // Initialize the form by showing the first step
        showStep(currentStep);
    </script>
</body>
</html>
